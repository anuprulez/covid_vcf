<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
   
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-axis.v1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.8.0-alpha.1/d3-tip.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>

    	
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">

    <style type="text/css">



    </style>
  </head>
  <body>
  
  <div style="margin:1%">
  
  Select analysis:
  
  <div >
  
  <select id="select_analysis" name="select_analysis" onchange="get_analysis(this)">
    <option value ="-1" selected>None</option>
    <option value ="https://raw.githubusercontent.com/anuprulez/covid_vcf/sklearn/data/outputs/Boston/all/only_insertions.csv">Boston all</option>
  </select>
  
  </div>
  
  
  Filter AF:
  
  <div>
  <select id="filter_minaf" onchange="filterMinAF(this)">
    <option value ="-1">None</option>
    <option value ="greater_than_equal">Greater than equal to</option>
    <option value ="less_than">Less than</option>
  </select>
  
  <input id="txt_minAF" type="text">
  <input id="btn_minAF" type="button" value="Apply" onclick="apply_minAF(this)">
  
  
  </div>
  
  <div>
  
  <select id="filter_maxaf">
    <option value ="-1">None</option>
    <option value ="greater_than_equal">Greater than equal to</option>
    <option value ="less_than">Less than</option>
  </select>
  
  

  </div>
 <table id="specific_run_table" class="table table-striped table-bordered" style="width:95%">

 </table>
    
        
    <script type="text/javascript">
    
    global_data = [];
    
    function apply_minAF(e) {
        minAF_ope = $("#filter_minaf").val()
        txtVal = $("#txt_minAF").val()
        if (minAF_ope === "less_than") {
            set_table(global_data, "<", txtVal);
        }
    }
    
    function set_table(data, operator, value) {
        filteredData = [];
        
        for(i=0; i< data.length; i++) {
            minAF = data[i]["MinAF"]
            if (operator == "<") {
                if (minAF < value) {
                    filteredData.push(data[i])
                }
            }
        }
        const columns = ["REF","POS", "ALT", "MinAF", "MaxAF", "NumSamples", "MutationCluster"]
        global_data = filteredData;
        crateTable(filteredData, columns)
    }
        

    function get_analysis(e) {
      var path = e.value;
      d3.csv(path)
          .get(function(data) {
              const columns = ["REF","POS", "ALT", "MinAF", "MaxAF", "NumSamples", "MutationCluster"]
              global_data = data;
              crateTable(data, columns)
       });
       console.log(path);
    }
    
    function filterMinAF(e) {
        
    
    }
    
    function filterMaxAF(e) {
        
    
    }
    
    
    
let crateTable = function (data,columns) {
    var table = d3.select('#specific_run_table')
      var thead = table.append('thead')
      var tbody = table.append('tbody')


      thead.append('tr')
        .selectAll('th')
          .data(columns)
          .enter()
        .append('th')
          .text(function (d) { return d })

      var rows = tbody.selectAll('tr')
          .data(data)
          .enter()
        .append('tr')

      var cells = rows.selectAll('td')
          .data(function(row) {
              return columns.map(function (column) {
                  return { column: column, value: row[column] }
            })
        })
        .enter()
      .append('td')
        .text(function (d) { return d.value })

    return table;
  }
	 
    </script>
  </div>
  </body>
</html>
